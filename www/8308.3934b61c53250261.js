"use strict";(self.webpackChunkKonektobet=self.webpackChunkKonektobet||[]).push([[8308],{8308:(U,E,d)=>{d.d(E,{$:()=>N});var a=d(5861),b=d(7700),C=d(3519),w=d.n(C),x=d(7851),S=d(5016),e=d(5879),D=d(7344),q=d(1896),F=d(9850),O=d(6814),I=d(617),T=d(2296);function k(m,j){1&m&&(e.TgZ(0,"mat-icon"),e._uU(1,"favorite"),e.qZA())}function R(m,j){if(1&m){const t=e.EpF();e.TgZ(0,"button",16),e.NdJ("click",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.addToFavorites())}),e._uU(1),e.YNc(2,k,2,0,"mat-icon",17),e.qZA()}if(2&m){const t=e.oxw();e.Q6J("disabled",t.addedToFavorites),e.xp6(1),e.hij(" ",t.addedToFavorites?"Added to Favorites":"Add to Favorites"," "),e.xp6(1),e.Q6J("ngIf",!t.isFavorite)}}const A=function(m){return{matched:m}};let N=(()=>{class m{constructor(t,n,i,o,r,s,l){this.dialogRef=t,this.data=n,this.supabaseService=i,this.dialog=o,this.router=r,this.initialRecommendService=s,this.cdr=l,this.clinics=[],this.clinicFeatures=[],this.selectedServices=[],this.selectedSchedules=[],this.selectedHealthcares=[],this.recommendedClinics=[],this.matchedClinics=[],this.loading=!1,this.clinicsFound=!1,this.lastTwoClinics=[],this.addedToFavorites=!1,this.isFavorite=!1,this.clinic=n.clinic,this.recommendedClinics=n.recommendedClinics||[],this.loadAdditionalClinicDetails()}ngOnInit(){var t=this;return(0,a.Z)(function*(){t.loadClinicFeatures(),t.addedToFavorites=yield t.isInFavorites(t.clinic),t.addedToFavorites&&(t.isFavorite=!0)})()}onClose(){this.dialogRef.close()}openMakeAppointmentPopup(){this.dialog.open(x.j,{width:"50%",height:"auto",data:{clinic:this.clinic}}).afterClosed().subscribe(n=>{}),this.dialogRef.close()}loadAdditionalClinicDetails(){var t=this;return(0,a.Z)(function*(){try{const n=t.clinic.id,{data:i,error:o}=yield t.supabaseService.getSupabase().from("clinic_tbl").select("*").eq("cUsers_id",n);o?console.error("Error fetching additional clinic details:",o):t.clinic={...t.clinic,...i}}catch(n){console.error("Error:",n)}})()}addToFavorites(){var t=this;return(0,a.Z)(function*(){try{const n=t.supabaseService.getAuthStateSnapshot();if(n){const{data:i,error:o}=yield t.supabaseService.getSupabase().from("users_tbl").select("id").eq("email",n.email);if(o)console.error("Error fetching user data:",o);else if(i&&i.length>0){const{data:r,error:s}=yield t.supabaseService.getSupabase().from("clinic_tbl").select("*").eq("id",t.clinic.id);if(console.log(t.clinic.id),s)return void console.error("Error fetching clinic details:",s);if(yield t.isInFavorites(t.clinic))return console.log("Clinic is already in favorites."),void(t.isFavorite=!0);const c={fvUsers_id:i[0].id,fvClinic_id:r[0].id,fvService:r[0].cService,fvSchedule:r[0].cSchedule,fvName:r[0].cName,fvAddress:r[0].cAddress,fvNumber:r[0].cNumber,fvEmail:r[0].cEmail,fvVet:r[0].cVet,fvLink:r[0].cLink,fvPrice:r[0].cPrice,fvTime:r[0].cTime};console.log(r[0].id);const{data:f,error:_}=yield t.supabaseService.getSupabase().from("favorites_tbl").insert([c]);_?console.error("Error inserting into favorites:",_):(console.log("Added to favorites successfully:",f),w().fire({icon:"success",title:"Successfully added to favorites!",text:"The clinic has been added as a favorite."}),t.addedToFavorites=!0,t.disableAddToFavoritesButton(),t.initialRecommendService.setReloadAllClinics(!0),yield t.generateRecommendations())}else console.error("No user data found for the logged-in user.")}else t.router.navigate(["/login"]),t.dialogRef.close(),console.error("No logged-in user found.")}catch(n){console.error("Error:",n)}})()}isInFavorites(t){var n=this;return(0,a.Z)(function*(){const i=yield n.supabaseService.getAuthStateSnapshot();if(i){const{data:o,error:r}=yield n.supabaseService.getSupabase().from("users_tbl").select("id").eq("email",i.email).single();if(r)return console.error("Error fetching user data:",r),!1;if(o){const s=o.id,{data:l,error:c}=yield n.supabaseService.getSupabase().from("favorites_tbl").select("*").eq("fvUsers_id",s).eq("fvClinic_id",t.id);return c?(console.error("Error fetching favorites data:",c),!1):l&&l.length>0}return console.error("No user data found for the logged-in user."),!1}return console.error("No logged-in user found."),!1})()}disableAddToFavoritesButton(){const t=document.getElementById("addToFavoritesButton");t&&t.setAttribute("disabled","true")}clinicDetailsClickedInFavoritesTab(){this.isFavorite=!0}popSeeMoreDetails(t){var n=this;return(0,a.Z)(function*(){n.dialog.open(m,{width:"50%",height:"auto",data:{clinic:t}}).afterClosed().subscribe(o=>{})})()}openMap(t,n){t.preventDefault();const o=`https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(n)}`;this.dialog.open(S.E,{width:"50%",height:"auto",data:{url:o,clinicAddress:n}})}isServiceSelected(t){return this.selectedServices.includes(t)}isScheduleSelected(t){return this.selectedSchedules.includes(t)}generateRecommendations(){var t=this;return(0,a.Z)(function*(){try{const n=t.supabaseService.getAuthStateSnapshot();if(n){const{data:i,error:o}=yield t.supabaseService.getSupabase().from("users_tbl").select("*").eq("email",n.email);if(o)console.error("Error fetching user data:",o);else if(i){const r=i[0].id,{data:s,error:l}=yield t.supabaseService.getSupabase().from("favorites_tbl").select("fvService, fvSchedule").eq("fvUsers_id",r);if(l)console.error("Error fetching user preferences from favorites:",l);else if(s&&s.length>0){const c=t.createUniqueServicesAndSchedules(s),f={favUsers_id:r,favService:c[0].favService,favSchedule:c[0].favSchedule};console.log(f);const{error:g}=yield t.supabaseService.getSupabase().from("favRecommend_tbl").delete().eq("favUsers_id",r);if(g)console.error("Error deleting data",g);else{console.log("Deleted successfully");const{data:u,error:p}=yield t.supabaseService.getSupabase().from("favRecommend_tbl").insert([f]);if(p)console.error("Error inserting user preferences:",p);else{console.log("User preferences added successfuly",u);const{error:y}=yield t.supabaseService.getSupabase().from("favRecommend_tbl").select("*").eq("favUsers_id",f.favUsers_id);if(y)console.error("Error fetching user preferences:",y);else{const h=t.matchClinicsContentBased(f);t.initialRecommendService.setMatchedClinics(yield h),(yield h).sort((v,M)=>(void 0!==M.similarity?M.similarity:0)-(void 0!==v.similarity?v.similarity:0)),(yield h).forEach((v,M)=>{v.rank=M+1});const Z=t.recommendClinics(yield h);console.log("Matched Clinics:",h),console.log("Recommended Clinics:",Z),t.clinics=(yield h).map(v=>({...v,similarity:void 0})),t.clinicsFound=(yield h).length>0,t.lastTwoClinics=Z.map(v=>({...v,similarity:void 0})),t.loading=!1,t.clinicsFound=(yield h).length>0,t.cdr.detectChanges(),yield t.saveFavMatchedClinics(yield h)}}}}else console.error("No favorites found for the user.")}}}catch(n){console.error("Error generating recommendations:",n)}})()}createUniqueServicesAndSchedules(t){const n=new Set,i=new Set;return t.forEach(r=>{const s=r.fvService?r.fvService.split(",").map(c=>c.trim()):[],l=r.fvSchedule?r.fvSchedule.split(",").map(c=>c.trim()):[];s.forEach(c=>n.add(c)),l.forEach(c=>i.add(c))}),[{favService:Array.from(n).join(", "),favSchedule:Array.from(i).join(", ")}]}saveFavMatchedClinics(t){var n=this;return(0,a.Z)(function*(){try{const i=n.supabaseService.getAuthStateSnapshot();if(i){const{data:o,error:r}=yield n.supabaseService.getSupabase().from("users_tbl").select("id").eq("email",i.email);if(r)console.error("Error fetching user data:",r);else if(o&&o.length>0){const s=o[0].id,{error:c}=yield n.supabaseService.getSupabase().from("favMatched_tbl").delete().eq("fvmUsers_id",s);if(c)return void console.error("Error deleting exisitng favMatched clinics:",c);const f=[];for(const u of t){const{data:p,error:P}=yield n.supabaseService.getSupabase().from("clinic_tbl").select("id").eq("cName",u.cName);P?console.error("Error fetching clinic data:",P):p&&p.length>0?f.push({fvmUsers_id:s,fvmClinic_id:p[0].id,fvmService:u.cService,fvmSchedule:u.cSchedule,fvmName:u.cName,fvmAddress:u.cAddress,fvmEmail:u.cEmail,fvmNumber:u.cNumber,fvmVet:u.cVet,fvmLink:u.cLink,fvmPrice:u.cPrice,fvmTime:u.cTime}):console.error(`No clinic data found for clinic: ${u.cName}`)}const{data:_,error:g}=yield n.supabaseService.getSupabase().from("favMatched_tbl").insert(f);g?console.error("Error inserting favMatched clinics:",g):console.log("FavMatched clinics added successfully:",_)}else console.error("No user data found for the logged-in user.")}}catch(i){console.error("Error saving matched clinics:",i)}finally{n.loading=!1}})()}calculateSimilarity(t,n){return(2*this.calculateIntersection(t.cService,n.favService)+1*this.calculateIntersection(t.cSchedule,n.favSchedule)+3*(void 0!==t.rank?t.rank:0))/6}calculateIntersection(t,n){const i=new Set(t.split(", ")),o=new Set(n.split(", "));return new Set([...i].filter(s=>o.has(s))).size}countMatches(t,n){let i=0;const o=t.cService.split(", "),r=t.cSchedule.split(", ");return i+=o.filter(s=>n.favService.includes(s)).length,i+=r.filter(s=>n.favSchedule.includes(s)).length,i}matchClinicsContentBased(t){var n=this;return(0,a.Z)(function*(){const i=[],o=n.supabaseService.getAuthStateSnapshot();if(o){const{data:r,error:s}=yield n.supabaseService.getSupabase().from("users_tbl").select("id").eq("email",o.email).single();if(!s&&r){const{data:c,error:f}=yield n.supabaseService.getSupabase().from("favorites_tbl").select("fvClinic_id");if(f)return console.error("Error fetching user favorites:",f),i;const _=c.map(g=>g.fvClinic_id);n.clinicFeatures.forEach((g,u)=>{if(!_.includes(g.id)){const p=n.countMatches(g,t);p>0&&i.push({...g,matchCount:p,rank:u+1})}})}}return i.sort((r,s)=>s.matchCount-r.matchCount),i.forEach((r,s)=>{r.rank=s+1}),i})()}recommendClinics(t){return this.clinicFeatures.filter(i=>!t.some(o=>o.cService===i.cService)).slice(0,2)}loadMatchedClinics(){var t=this;return(0,a.Z)(function*(){try{const n=t.supabaseService.getAuthStateSnapshot();if(n){const{data:i,error:o}=yield t.supabaseService.getSupabase().from("users_tbl").select("id").eq("email",n.email).single();if(o)console.error("Error fetching user data:",o);else if(i){const{data:s,error:l}=yield t.supabaseService.getSupabase().from("clinic_tbl").select("*");l?console.error("Error fetching matched clinics:",l):t.clinics=s||[]}else console.error("No user data found for the logged-in user.")}else console.error("No logged-in user found. Redirecting to the login page.")}catch(n){console.error("Error:",n)}})()}loadClinicFeatures(){var t=this;return(0,a.Z)(function*(){try{const n=yield t.supabaseService.getAuthStateSnapshot();if(n){const{data:i,error:o}=yield t.supabaseService.getSupabase().from("users_tbl").select("*").eq("email",n.email).single();if(o)console.error("Error fetching user data:",o);else if(i){const s=yield t.supabaseService.getSupabase().from("clinic_tbl").select("*");s.error?console.error("Error fetching clinic features:",s.error):t.clinicFeatures=s.data}}else console.error("No logged-in user found. Redirecting to the login page.")}catch(n){console.error("Error fetching clinic features:",n)}})()}static#e=this.\u0275fac=function(n){return new(n||m)(e.Y36(b.so),e.Y36(b.WI),e.Y36(D.T),e.Y36(b.uw),e.Y36(q.F0),e.Y36(F.h),e.Y36(e.sBO))};static#t=this.\u0275cmp=e.Xpm({type:m,selectors:[["app-clinic-details"]],decls:70,vars:20,consts:[[1,"clinic-details-container"],[1,"title"],["mat-dialog-title",""],["mat-icon-button","",1,"close-icon",3,"click"],["mat-dialog-content","",1,"clinic-details"],[1,"details-container"],[1,"details-logo-container"],["src","assets/logo.png","alt","logo.png"],[1,"details-txt-container"],[1,"clinic-name"],[1,"icons"],[1,"icons",3,"ngClass"],["target","_blank",3,"href"],["mat-dialog-actions","",1,"detail-btn"],["id","addToFavoritesButton","mat-raised-button","","color","primary","class","add-to-favorites-btn",3,"disabled","click",4,"ngIf"],["mat-raised-button","","color","accent",1,"make-appointment-btn",3,"click"],["id","addToFavoritesButton","mat-raised-button","","color","primary",1,"add-to-favorites-btn",3,"disabled","click"],[4,"ngIf"]],template:function(n,i){1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),e._uU(3),e.qZA(),e.TgZ(4,"button",3),e.NdJ("click",function(){return i.onClose()}),e.TgZ(5,"mat-icon"),e._uU(6,"close"),e.qZA()()(),e.TgZ(7,"div",4)(8,"div",5)(9,"div",6),e._UZ(10,"img",7),e.qZA(),e.TgZ(11,"div",8)(12,"div",9)(13,"h1"),e._uU(14),e.qZA()(),e.TgZ(15,"div",10)(16,"mat-icon"),e._uU(17,"location_on"),e.qZA(),e.TgZ(18,"h1"),e._uU(19),e.qZA()(),e.TgZ(20,"div",10)(21,"mat-icon"),e._uU(22," local_phone"),e.qZA(),e.TgZ(23,"h1"),e._uU(24),e.qZA()(),e.TgZ(25,"div",10)(26,"mat-icon"),e._uU(27," email"),e.qZA(),e.TgZ(28,"h1"),e._uU(29),e.qZA()(),e.TgZ(30,"div",11)(31,"mat-icon"),e._uU(32," sentiment_satisfied_alt"),e.qZA(),e.TgZ(33,"h1"),e._uU(34),e.qZA()(),e.TgZ(35,"div",10)(36,"mat-icon"),e._uU(37,"money"),e.qZA(),e.TgZ(38,"h1"),e._uU(39),e.qZA()(),e.TgZ(40,"div",10)(41,"mat-icon"),e._uU(42,"money"),e.qZA(),e.TgZ(43,"h1"),e._uU(44),e.qZA()(),e.TgZ(45,"div",10)(46,"mat-icon"),e._uU(47,"money"),e.qZA(),e.TgZ(48,"h1"),e._uU(49),e.qZA()(),e.TgZ(50,"div",10)(51,"mat-icon"),e._uU(52,"schedule"),e.qZA(),e.TgZ(53,"h1"),e._uU(54),e.qZA()(),e.TgZ(55,"div",11)(56,"mat-icon"),e._uU(57,"date_range"),e.qZA(),e.TgZ(58,"h1"),e._uU(59),e.qZA()(),e.TgZ(60,"div",10)(61,"mat-icon"),e._uU(62,"link"),e.qZA(),e.TgZ(63,"h1")(64,"a",12),e._uU(65),e.qZA()()()(),e.TgZ(66,"div",13),e.YNc(67,R,3,3,"button",14),e.TgZ(68,"button",15),e.NdJ("click",function(){return i.openMakeAppointmentPopup()}),e._uU(69," Make Appointment "),e.qZA()()()()()),2&n&&(e.xp6(3),e.hij("",i.clinic.cName||i.clinic.mName," Details"),e.xp6(11),e.Oqu(i.clinic.cName||i.clinic.mName),e.xp6(5),e.Oqu(i.clinic.cAddress||i.clinic.mAddress),e.xp6(5),e.Oqu(i.clinic.cNumber||i.clinic.mNumber),e.xp6(5),e.Oqu(i.clinic.cEmail||i.clinic.mEmail),e.xp6(1),e.Q6J("ngClass",e.VKq(16,A,i.isServiceSelected(i.service))),e.xp6(4),e.Oqu(i.clinic.cService),e.xp6(5),e.hij("\u20b1",i.clinic.cGrmPrice,""),e.xp6(5),e.hij("\u20b1",i.clinic.cLabPrice,""),e.xp6(5),e.hij("\u20b1",i.clinic.cSrgPrice,""),e.xp6(5),e.Oqu(i.clinic.cTime),e.xp6(1),e.Q6J("ngClass",e.VKq(18,A,i.isScheduleSelected(i.schedule))),e.xp6(4),e.Oqu(i.clinic.cSchedule||i.clinic.mSchedule),e.xp6(5),e.Q6J("href",i.clinic.cLink||i.clinic.mLink,e.LSH),e.xp6(1),e.Oqu(i.clinic.cLink||i.clinic.mLink),e.xp6(2),e.Q6J("ngIf",!i.isFavorite))},dependencies:[O.mk,O.O5,I.Hw,T.lW,T.RK],styles:[".title[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin:20px}.title[_ngcontent-%COMP%]{display:flex;justify-content:space-between}.title[_ngcontent-%COMP%]   .reco[_ngcontent-%COMP%]{margin-right:110px}.clinic-details[_ngcontent-%COMP%]{display:flex;justify-content:space-evenly;flex-wrap:wrap;flex-direction:column}.details-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;align-items:center;justify-content:center;flex-direction:column}@media screen and (max-width: 600px){mat-dialog-content[_ngcontent-%COMP%]{width:100%}}.details-logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;flex-wrap:wrap;flex-direction:column;width:200px;height:auto;margin:0 0 30px}.details-txt-container[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:flex-start;flex-wrap:wrap;flex-direction:column}.details-txt-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{size:50px}.service[_ngcontent-%COMP%]{display:inline-block}.wrap[_ngcontent-%COMP%]{white-space:nowrap}.detail-btn[_ngcontent-%COMP%]{display:flex;justify-content:center;width:70%;margin:0 auto 30px}.detail-btn[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin:0}.add-to-favorites-btn[_ngcontent-%COMP%]{order:1;margin-right:10px}.make-appointment-btn[_ngcontent-%COMP%]{order:2;margin-left:10px}@media screen and (max-width: 769px){.details-logo-container[_ngcontent-%COMP%]{margin:0}.details-logo-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;flex-wrap:wrap;flex-direction:column;width:100px;height:auto;margin-left:30px}.details-txt-container[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:flex-start;flex-wrap:wrap;flex-direction:column;width:90%;margin-top:20px}.service[_ngcontent-%COMP%]{display:inline-block}.wrap[_ngcontent-%COMP%]{white-space:nowrap}.detail-btn[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;width:100%;justify-content:center;margin-bottom:10px}.add-to-favorites-btn[_ngcontent-%COMP%], .make-appointment-btn[_ngcontent-%COMP%]{width:100%;margin:5px 0}.make-appointment-btn[_ngcontent-%COMP%]{order:3}.title[_ngcontent-%COMP%]{display:flex;justify-content:center}}.recommended-clinics-container[_ngcontent-%COMP%]{display:flex;flex-direction:column}.title1[_ngcontent-%COMP%]{display:flex;justify-content:center}.recommended-clinics[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;justify-content:space-evenly}.clinic-card[_ngcontent-%COMP%]{width:450px;margin-bottom:20px;overflow:absolute;border-top-left-radius:10px;border-top-right-radius:10px}.clinic-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:0;display:flex;width:auto;flex-wrap:nowrap;align-items:baseline;flex-direction:column}.clinic-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:auto;display:flex;align-items:center;justify-content:flex-start;padding:20px}.clinic-logo[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:row;flex-wrap:wrap}.clinic-txt[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:flex-start;flex-direction:column;flex-wrap:wrap;margin:20px 0 0;color:#fff}.see-more[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;justify-content:flex-end;overflow:relative;margin-right:20px}.see-more[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{order:2;display:flex;justify-content:center;align-items:center;margin-left:5px}.see-more1[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.see-more[_ngcontent-%COMP%]   mat-raised-button[_ngcontent-%COMP%]{order:1;width:auto}.bot-part-container[_ngcontent-%COMP%]{height:70px;width:100%;display:flex;align-items:center;justify-content:row;background-color:#fff;border-top-left-radius:10px;border-top-right-radius:10px;overflow:relative;box-shadow:2px 2px 10px #00000013;background-color:#1c4370}.icons[_ngcontent-%COMP%]{display:flex}.icons[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin:5px 5px 5px 0}.clinic-name[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:40px;text-transform:uppercase}.icons[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}"]})}return m})()},5016:(U,E,d)=>{d.d(E,{E:()=>b});var a=d(5879);let b=(()=>{class C{static#e=this.\u0275fac=function(S){return new(S||C)};static#t=this.\u0275cmp=a.Xpm({type:C,selectors:[["app-maps"]],decls:8,vars:0,consts:[[1,"dialog-container"],[1,"dialog-header"],[1,"dialog-content"],[1,"map-container"],["mapContainer",""],[1,"dialog-footer"]],template:function(S,e){1&S&&(a.TgZ(0,"div",0)(1,"div",1)(2,"h2"),a._uU(3,"Map"),a.qZA()(),a.TgZ(4,"div",2),a._UZ(5,"div",3,4),a.qZA(),a._UZ(7,"div",5),a.qZA())},styles:["#map-canvas[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%}"]})}return C})()}}]);