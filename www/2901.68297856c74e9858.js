"use strict";(self.webpackChunkKonektobet=self.webpackChunkKonektobet||[]).push([[2901],{2901:(k,w,l)=>{l.r(w),l.d(w,{FavoritesModule:()=>L});var x=l(6814),y=l(1896),v=l(5861),O=l(7700),U=l(3519),E=l.n(U),A=l(2201),e=l(5879),T=l(7344),D=l(9850),b=l(5195),F=l(617);function N(s,M){1&s&&(e.TgZ(0,"div",14)(1,"mat-icon"),e._uU(2,"arrow_forward_ios"),e.qZA(),e.TgZ(3,"label")(4,"strong"),e._uU(5,"See more"),e.qZA()()())}const I=function(s){return["/favorite-details",s]};function q(s,M){if(1&s){const t=e.EpF();e.TgZ(0,"a",6)(1,"mat-card",7),e.NdJ("mouseenter",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onMouseEnter())})("mouseleave",function(){e.CHM(t);const i=e.oxw();return e.KtG(i.onMouseLeave())}),e.TgZ(2,"mat-card-content")(3,"div",8),e._UZ(4,"img",9)(5,"div",10),e.qZA(),e.YNc(6,N,6,0,"div",11),e.TgZ(7,"div",12)(8,"div",13)(9,"h2"),e._uU(10),e.qZA(),e.TgZ(11,"h2"),e._uU(12),e.qZA()()()()()()}if(2&s){const t=M.$implicit,n=e.oxw();e.Q6J("routerLink",e.VKq(5,I,t.fvClinic_id)),e.xp6(4),e.Q6J("src",t.logo||"assets/logo.png",e.LSH),e.xp6(2),e.Q6J("ngIf",n.isHovered),e.xp6(4),e.Oqu(t.fvName),e.xp6(2),e.Oqu(t.fvAddress)}}function j(s,M){1&s&&(e.TgZ(0,"div")(1,"div",15),e._UZ(2,"img",16),e.qZA(),e.TgZ(3,"div",17)(4,"h1"),e._uU(5,"You haven't added a clinic to your favorites"),e.qZA(),e.TgZ(6,"h2"),e._uU(7,"Select a clinic then click the heart icon to see the clinic here."),e.qZA()()())}const R=[{path:"",component:(()=>{class s{constructor(t,n,i,r){this.supabaseService=t,this.dialog=n,this.initialRecommendService=i,this.cdr=r,this.clinics=[],this.favoriteClinics=[],this.displayedClinics=[],this.lastTwoClinics=[],this.clinicFeatures=[],this.loading=!1,this.clinicsFound=!1,this.isHovered=!1}ngOnInit(){this.loadClinics()}onMouseEnter(){this.isHovered=!0}onMouseLeave(){this.isHovered=!1}loadClinics(){var t=this;return(0,v.Z)(function*(){try{const n=yield t.supabaseService.getAuthStateSnapshot();if(n){const{data:i,error:r}=yield t.supabaseService.getSupabase().from("users_tbl").select("id").eq("email",n.email);if(r)console.error("Error fetching user data:",r);else if(i&&i.length>0){const o=i[0].id,{data:c,error:f}=yield t.supabaseService.getSupabase().from("favorites_tbl").select("*").eq("fvUsers_id",o);f?console.error("Error fetching clinics:",f):t.clinics=c||[]}else console.error("No user data found for the logged-in user.")}else console.error("No logged-in user found.")}catch(n){console.error("Error:",n)}})()}deleteClinic(t){E().fire({title:"Remove this to your Favorites?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3f51b5",confirmButtonText:"Yes, remove it!"}).then(n=>{if(n.isConfirmed){const i=this.clinics.findIndex(r=>r.id===t.id);-1!==i&&this.clinics.splice(i,1),this.deleteClinicFromDatabase(t.id)}})}deleteClinicFromDatabase(t){var n=this;return(0,v.Z)(function*(){try{const{error:i}=yield n.supabaseService.getSupabase().from("favorites_tbl").delete().eq("id",t);i?console.error("Error deleting clinic:",i):E().fire({icon:"success",title:"Clinic Removed Successfully",text:"The clinic has been removed from favorites."})}catch(i){console.error("Error:",i)}})()}popSeeMoreDetails(t){const n=new O.vA;n.width=window.innerWidth>768?"55%":"90%",n.height=window.innerHeight>768?"auto":"90%",n.data={clinic:t},this.dialog.open(A.v,n).afterClosed().subscribe(r=>{})}generateRecommendations(){var t=this;return(0,v.Z)(function*(){try{const n=t.supabaseService.getAuthStateSnapshot();if(n){const{data:i,error:r}=yield t.supabaseService.getSupabase().from("users_tbl").select("*").eq("email",n.email);if(r)console.error("Error fetching user data:",r);else if(i){const o=i[0].id,{data:c,error:f}=yield t.supabaseService.getSupabase().from("favorites_tbl").select("fvService, fvSchedule").eq("fvUsers_id",o);if(f)console.error("Error fetching user preferences from favorites:",f);else if(c&&c.length>0){const a=t.createUniqueServicesAndSchedules(c),m={favUsers_id:o,favService:a[0].favService,favSchedule:a[0].favSchedule};console.log(m);const{error:p}=yield t.supabaseService.getSupabase().from("favRecommend_tbl").delete().eq("favUsers_id",o);if(p)console.error("Error deleting data",p);else{console.log("Deleted successfully");const{data:d,error:g}=yield t.supabaseService.getSupabase().from("favRecommend_tbl").insert([m]);if(g)console.error("Error inserting user preferences:",g);else{console.log("User preferences added successfuly",d);const{error:C}=yield t.supabaseService.getSupabase().from("favRecommend_tbl").select("*").eq("favUsers_id",m.favUsers_id);if(C)console.error("Error fetching user preferences:",C);else{const u=t.matchClinicsContentBased(m);t.initialRecommendService.setMatchedClinics(u),u.sort((h,S)=>(void 0!==S.similarity?S.similarity:0)-(void 0!==h.similarity?h.similarity:0)),u.forEach((h,S)=>{h.rank=S+1});const Z=t.recommendClinics(u);console.log("Matched Clinics:",u),console.log("Recommended Clinics:",Z),t.clinics=u.map(h=>({...h,similarity:void 0})),t.clinicsFound=u.length>0,t.lastTwoClinics=Z.map(h=>({...h,similarity:void 0})),t.loading=!1,t.clinicsFound=u.length>0,t.cdr.detectChanges(),yield t.saveFavMatchedClinics(u)}}}}else console.error("No favorites found for the user.")}}}catch(n){console.error("Error generating recommendations:",n)}})()}createUniqueServicesAndSchedules(t){const n=new Set,i=new Set;return t.forEach(o=>{const c=o.fvService?o.fvService.split(",").map(a=>a.trim()):[],f=o.fvSchedule?o.fvSchedule.split(",").map(a=>a.trim()):[];c.forEach(a=>n.add(a)),f.forEach(a=>i.add(a))}),[{favService:Array.from(n).join(", "),favSchedule:Array.from(i).join(", ")}]}saveFavMatchedClinics(t){var n=this;return(0,v.Z)(function*(){try{const i=n.supabaseService.getAuthStateSnapshot();if(i){const{data:r,error:o}=yield n.supabaseService.getSupabase().from("users_tbl").select("id").eq("email",i.email);if(o)console.error("Error fetching user data:",o);else if(r&&r.length>0){const c=r[0].id,{error:a}=yield n.supabaseService.getSupabase().from("favMatched_tbl").delete().eq("fvmUsers_id",c);if(a)return void console.error("Error deleting exisitng favMatched clinics:",a);const m=[];for(const d of t){const{data:g,error:P}=yield n.supabaseService.getSupabase().from("clinic_tbl").select("id").eq("cName",d.cName);P?console.error("Error fetching clinic data:",P):g&&g.length>0?m.push({fvmUsers_id:c,fvmClinic_id:g[0].id,fvmService:d.cService,fvmSchedule:d.cSchedule,fvmName:d.cName,fvmAddress:d.cAddress,fvmEmail:d.cEmail,fvmNumber:d.cNumber,fvmVet:d.cVet,fvmLink:d.cLink,fvmPrice:d.cPrice,fvmTime:d.cTime}):console.error(`No clinic data found for clinic: ${d.cName}`)}const{data:_,error:p}=yield n.supabaseService.getSupabase().from("favMatched_tbl").insert(m);p?console.error("Error inserting favMatched clinics:",p):console.log("FavMatched clinics added successfully:",_)}else console.error("No user data found for the logged-in user.")}}catch(i){console.error("Error saving matched clinics:",i)}finally{n.loading=!1}})()}calculateSimilarity(t,n){return(2*this.calculateIntersection(t.cService,n.favService)+1*this.calculateIntersection(t.cSchedule,n.favSchedule)+3*(void 0!==t.rank?t.rank:0))/6}calculateIntersection(t,n){const i=new Set(t.split(", ")),r=new Set(n.split(", "));return new Set([...i].filter(c=>r.has(c))).size}countMatches(t,n){let i=0;const r=t.cService.split(", "),o=t.cSchedule.split(", ");return i+=r.filter(c=>n.favService.includes(c)).length,i+=o.filter(c=>n.favSchedule.includes(c)).length,i}matchClinicsContentBased(t){const n=[];return this.clinicFeatures.forEach((i,r)=>{const o=this.countMatches(i,t);o>0&&n.push({...i,matchCount:o,rank:r+1})}),n.sort((i,r)=>r.matchCount-i.matchCount),n.forEach((i,r)=>{i.rank=r+1}),n}recommendClinics(t){return this.clinicFeatures.filter(i=>!t.some(r=>r.cService===i.cService)).slice(0,2)}loadClinicFeatures(){var t=this;return(0,v.Z)(function*(){try{const n=yield t.supabaseService.getAuthStateSnapshot();if(n){const{data:i,error:r}=yield t.supabaseService.getSupabase().from("users_tbl").select("*").eq("email",n.email).single();if(r)console.error("Error fetching user data:",r);else if(i){const o=i.id,c=yield t.supabaseService.getSupabase().from("clinic_tbl").select("*");c.error?console.error("Error fetching clinic features:",c.error):yield t.supabaseService.getSupabase().from("favorites_tbl").select("*").eq("fvUsers_id",o)}}else console.error("No logged-in user found. Redirecting to the login page.")}catch(n){console.error("Error fetching clinic features:",n)}})()}static#e=this.\u0275fac=function(n){return new(n||s)(e.Y36(T.T),e.Y36(O.uw),e.Y36(D.h),e.Y36(e.sBO))};static#t=this.\u0275cmp=e.Xpm({type:s,selectors:[["app-favorites"]],decls:8,vars:2,consts:[[1,"outer-clinic-container"],[1,"clinics"],[1,"inner-clinic-container"],[1,"clinic-card-container"],["style","text-decoration: none;",3,"routerLink",4,"ngFor","ngForOf"],[4,"ngIf"],[2,"text-decoration","none",3,"routerLink"],[1,"clinic-card",2,"background-image","url('assets/bg.png')",3,"mouseenter","mouseleave"],[1,"clinic-logo"],["alt","Profile Image",3,"src"],[1,"clinic-txt"],["class","see-more1",4,"ngIf"],[1,"bot-part-container"],[1,"see-more"],[1,"see-more1"],[1,"no-data"],["src","assets/favorites.svg","alt",""],[1,"no-data-txt"]],template:function(n,i){1&n&&(e.TgZ(0,"body")(1,"div",0)(2,"h1",1),e._uU(3,"Favorite Clinics"),e.qZA(),e.TgZ(4,"div",2)(5,"div",3),e.YNc(6,q,13,7,"a",4),e.qZA()(),e.YNc(7,j,8,0,"div",5),e.qZA()()),2&n&&(e.xp6(6),e.Q6J("ngForOf",i.clinics),e.xp6(1),e.Q6J("ngIf",!i.clinics||0==i.clinics.length))},dependencies:[x.sg,x.O5,y.rH,b.a8,b.dn,F.Hw],styles:["body[_ngcontent-%COMP%]{background-color:#fafafa;height:93vh;margin:0}.clinics[_ngcontent-%COMP%]{text-align:center;font-size:30px;font-weight:700;margin-top:30px}.inner-clinic-container[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.clinic-card-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-wrap:wrap;justify-content:space-evenly;align-items:center;margin:3% 5% 0}.clinic-card[_ngcontent-%COMP%]{width:400px;height:210px;margin-bottom:30px;overflow:absolute;border-top-left-radius:10px;border-top-right-radius:10px}.clinic-card[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{padding:0;display:flex;width:auto;flex-wrap:nowrap;align-items:baseline;flex-direction:column}.clinic-logo[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100px;height:auto;display:flex;align-items:center;justify-content:flex-start;padding:20px}.clinic-logo[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;flex-direction:column;flex-wrap:wrap;width:100%}.clinic-txt[_ngcontent-%COMP%]{display:flex;align-items:flex-start;justify-content:flex-start;flex-direction:column;flex-wrap:wrap;color:#fff;text-align:center}.clinic-txt[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{width:100%;font-size:1rem}.clinic-txt[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;width:100%}@media screen and (max-width: 769px){.clinic-cards[_ngcontent-%COMP%]   mat-card-content[_ngcontent-%COMP%]{display:flex;width:350px}.clinic-card[_ngcontent-%COMP%]{width:350px;height:150px;margin-bottom:100px;overflow:absolute;border-top-left-radius:10px;border-top-right-radius:10px}.clinic-txt[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:16px}.clinic-txt[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:15px}}.see-more[_ngcontent-%COMP%]{width:100%;height:auto;display:flex;justify-content:center;overflow:relative;color:#fff;flex-direction:column}.see-more[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%], h2[_ngcontent-%COMP%]{width:100%;font-size:1rem;display:flex;justify-content:center;align-items:center;margin:0}.see-more1[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:24px;color:#000}.see-more1[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:#fffc;opacity:0;transition:opacity .3s ease}.see-more1[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{cursor:pointer;margin-bottom:8px;color:#000}.clinic-card[_ngcontent-%COMP%]:hover   .see-more1[_ngcontent-%COMP%]{opacity:1}.see-more[_ngcontent-%COMP%]   mat-raised-button[_ngcontent-%COMP%]{order:1;width:auto}.bot-part-container[_ngcontent-%COMP%]{height:70px;width:100%;display:flex;align-items:center;justify-content:row;background-color:#fff;border-top-left-radius:10px;border-top-right-radius:10px;overflow:relative;box-shadow:2px 2px 10px #00000013;background-color:#3f51b5}.no-data[_ngcontent-%COMP%]{width:100%;display:flex;justify-content:center}.no-data[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:350px;height:auto}.no-data-txt[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;margin-top:20px}@media screen and (max-width: 769px){.no-data-txt[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px}.no-data-txt[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:14px}}"]})}return s})()}];let z=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.oAB({type:s});static#n=this.\u0275inj=e.cJS({imports:[y.Bz.forChild(R),y.Bz]})}return s})();var B=l(2296);let L=(()=>{class s{static#e=this.\u0275fac=function(n){return new(n||s)};static#t=this.\u0275mod=e.oAB({type:s});static#n=this.\u0275inj=e.cJS({imports:[x.ez,z,b.QW,F.Ps,B.ot]})}return s})()}}]);